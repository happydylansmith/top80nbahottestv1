<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Top 80 Hottest NBA Players</title>
<link rel="shortcut icon" type="image/x-icon" href="favicon3.ico?">
<style>
body { font-family: Arial, Helvetica, sans-serif; background: #ffffff; color: #000; margin: 40px; }
h1 { font-size: 24px; margin-bottom: 5px; }
h2 { font-size: 16px; margin: 2px 0; }
h3 { font-size: 14px; margin: 10px 0; font-style: italic; }
h3 a { text-decoration: none; color: #808080; }

button { margin: 5px 5px 15px 0; padding: 6px 12px; font-size: 14px; border: 1px solid #000; background: #fff; cursor: pointer; }
button:hover { background: #000; color: #fff; }

.rank-list { max-width: 650px; }
.rank-item {
  display: flex;
  align-items: center;
  margin-bottom: 8px;
  padding: 4px;
  border: 1px solid #000;
  cursor: grab;
  background: #fff;
  max-width: 320px;
  transition: transform 0.2s ease;
  position: relative;
}
.rank-item.dragging { opacity: 0.8; cursor: grabbing; }
.rank-number { width: 40px; font-weight: bold; user-select: none; }
input { flex: 1; padding: 6px 8px; font-size: 14px; border: none; background: #fff; }
input:focus { outline: none; }
.player-photo { width: 50px; height: 50px; margin-left: 10px; object-fit: cover; }

/* Mobile arrow overlay */
.mobile-arrow {
  display: none; /* desktop hidden */
  position: absolute;
  right: 4px;
  width: 28px;
  height: 28px;
  cursor: pointer;
  z-index: 5;
  pointer-events: auto;
  background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><polygon points="6,9 12,15 18,9" fill="black"/></svg>') no-repeat center center;
  background-size: 16px 16px;
}

#comparisonView { display: none; margin-top: 20px; max-width: 800px; overflow-x: auto; }
#comparisonView table { border-collapse: collapse; width: 100%; }
#comparisonView th, #comparisonView td { border: 1px solid #ccc; padding: 5px; text-align: center; vertical-align: middle; min-width: 80px; }
#comparisonView th:nth-child(2), #comparisonView th:nth-child(4) { width: 150px; }
#comparisonView img { width: 40px; height: 40px; object-fit: cover; }
.legend { margin: 10px 0; font-size: 14px; }
.legend span { display: inline-block; width: 15px; height: 15px; margin-right: 5px; vertical-align: middle; }

@media (hover: none) and (pointer: coarse) {
  .rank-item input::placeholder { content: "Tap arrow for players"; }
  input { padding-right: 36px; }
  .mobile-arrow { display: block; }
}
</style>
</head>

<body>
<h1>Top 80 Hottest NBA Players</h1>
<h2>beauty is subjective. democracy is hot.</h2>
<h3><a href="https://www.instagram.com/nbaresdev/" target="_blank">@nbaresdev</a></h3>

<div>
  <button id="clearBtn">Clear All</button>
  <button id="submitBtn">Submit Rankings</button>
  <button id="shareBtn">Get Share Link</button>
  <button id="compareBtn">Compare to Our List</button>
  <button id="backBtn" style="display:none;">Back to Rankings</button>
  <button id="rankOwnBtn" style="display:none;">Rank Your Own List</button>
</div>

<div class="rank-list" id="rankList"></div>

<div id="comparisonView">
  <div class="legend">
    <span style="background:#a0c4ff;"></span> Higher Than Ours
    <span style="background:#ffe066; margin-left:10px;"></span> Lower Than Ours
    <span style="background:#ff6b6b; margin-left:10px;"></span> Not in Ours
    <span style="background:#8ae29c; margin-left:10px;"></span> Same Rank
  </div>
  <table id="comparisonTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Your List</th>
        <th></th>
        <th>Our List</th>
        <th></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxkn0DaLPfMDEUQfV_-6w1sUplcfprZH3Y5XZ9eiPcfHdA377o0GgQqNKr5a4yPehNuuQ/exec";
const STORAGE_KEY = "nbaTop80Rankings";
const placeholderImg = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQE2JzfjajVRBSq680ThapVigyN_j0ldaiZuoazqMti7c0-7Fgmi6Eq2pK6ZaQ1b9keLP-DKN0vzFKh&s";

const PLAYER_ID_OVERRIDES = {
  "Magic Johnson": "johnsma02",
  "Anthony Davis": "davisan02",
  "Wally Szczerbiak": "szczewa02",
  "Jared McCain": "mccaija02",
  "Shaquille O'Neal": "onealsh01",
  "D'Angelo Russell": "russeda01",
  "Victor Wembanyama": "wembavi01"
};

const fixedList = [ /* fixed 80 player list */];
const allPlayers = [ /* full 5000 player list */];

function photoURL(name){
  if(!name) return placeholderImg;
  if(name==="Jared McCain") return "https://www.basketball-reference.com/req/202106291/images/headshots/mccaija01.jpg";
  if(name==="Victor Wembanyama") return "https://www.basketball-reference.com/req/202106291/images/headshots/wembavi01.jpg";
  if(PLAYER_ID_OVERRIDES[name])
    return `https://www.basketball-reference.com/req/202112091/images/players/${PLAYER_ID_OVERRIDES[name]}.jpg`;

  const clean=name.replace(/'/g,"").toLowerCase().split(" ");
  if(clean.length<2) return placeholderImg;
  const first=clean[0];
  const last=clean.slice(1).join("");
  return `https://www.basketball-reference.com/req/202112091/images/players/${last.slice(0,5)+first.slice(0,2)}01.jpg`;
}

const rankList=document.getElementById("rankList");
const saved=JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");

for(let i=1;i<=80;i++){
  const d=document.createElement("div");
  d.className="rank-item";
  d.draggable=true;
  d.innerHTML=`
    <div class="rank-number">#${i}</div>
    <input list="players" value="${saved[i-1]||""}" placeholder="Enter player name"/>
    <img class="player-photo" src="${photoURL(saved[i-1])}" onerror="this.src='${placeholderImg}'>
    <div class="mobile-arrow"></div>
  `;
  rankList.appendChild(d);
}

/* Datalist for autocomplete */
const dl=document.createElement("datalist");
dl.id="players";
document.body.appendChild(dl);

function updateDatalist(val){
  dl.innerHTML="";
  if(!val) return;
  allPlayers.filter(p=>p.toLowerCase().includes(val.toLowerCase())).slice(0,10).forEach(p=>{
    const o=document.createElement("option");
    o.value=p;
    dl.appendChild(o);
  });
}

/* Save & update photos */
function save(){
  localStorage.setItem(STORAGE_KEY,JSON.stringify([...document.querySelectorAll(".rank-item input")].map(i=>i.value)));
}
function updatePhotos(){
  document.querySelectorAll(".rank-item").forEach(r=>{
    const i=r.querySelector("input");
    const img=r.querySelector("img");
    img.src = (!i.value || !allPlayers.includes(i.value)) ? placeholderImg : photoURL(i.value);
    img.onerror = () => img.src = placeholderImg;
  });
}
function updateNumbers(){
  document.querySelectorAll(".rank-item").forEach((item,index)=>{
    item.querySelector(".rank-number").textContent=`#${index+1}`;
  });
}

/* Drag & drop */
let draggedItem=null;
document.querySelectorAll(".rank-item").forEach(item=>{
  item.addEventListener("dragstart",()=>{ draggedItem=item; item.classList.add("dragging"); });
  item.addEventListener("dragend",()=>{ draggedItem=null; item.classList.remove("dragging"); save(); updatePhotos(); updateNumbers(); });
  item.addEventListener("dragover",e=>{
    e.preventDefault();
    const bounding=item.getBoundingClientRect();
    const offset=bounding.y + bounding.height/2;
    if(e.clientY - offset >0) item.after(draggedItem); else item.before(draggedItem);
  });
});

/* Input events */
document.querySelectorAll(".rank-item input").forEach(input=>{
  input.addEventListener("input",e=>{ updateDatalist(e.target.value); save(); updatePhotos(); });
});

/* Mobile arrow click */
if(window.matchMedia("(hover: none) and (pointer: coarse)").matches){
  document.querySelectorAll(".mobile-arrow").forEach(arrow=>{
    arrow.addEventListener("click",e=>{
      const input=arrow.parentElement.querySelector("input");
      input.focus();
      input.click();
    });
  });
}

/* Buttons: clear, submit, share, compare, back, rankOwn */
document.getElementById("clearBtn").onclick=()=>{
  document.querySelectorAll(".rank-item input").forEach(i=>i.value="");
  save(); updatePhotos();
};
document.getElementById("submitBtn").onclick=async()=>{
  const rankings=[...document.querySelectorAll(".rank-item input")].map(i=>i.value);
  try{ const res=await fetch(GOOGLE_SCRIPT_URL,{method:"POST",body:JSON.stringify(rankings)});
    alert(res.ok?"Rankings submitted!":"Error submitting rankings.");
  }catch(e){ alert("Error submitting rankings."); }
};
document.getElementById("shareBtn").onclick=()=>{
  const rankings=[...document.querySelectorAll(".rank-item input")].map(i=>i.value||"");
  const encoded=encodeURIComponent(rankings.join("|"));
  const url = `${location.origin}/?view=1&rankings=${encoded}`;
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(url).then(()=>alert("Share link copied!")).catch(()=>prompt("Copy this link:",url));
  } else { prompt("Copy this link:",url); }
};
document.getElementById("compareBtn").onclick=()=>{
  const body=document.querySelector("#comparisonTable tbody");
  body.innerHTML="";
  [...document.querySelectorAll(".rank-item input")].forEach((i,idx)=>{
    const n=i.value;
    const f=fixedList[idx]||"";
    const c=!n?"":!fixedList.includes(n)?"#ff6b6b":fixedList.indexOf(n)<idx?"#ffe066":fixedList.indexOf(n)>idx?"#a0c4ff":"#8ae29c";
    body.innerHTML+=`
      <tr>
        <td>#${idx+1}</td>
        <td style="background:${c}">${n}</td>
        <td><img src="${photoURL(n)}" onerror="this.src='${placeholderImg}'"></td>
        <td>${f}</td>
        <td><img src="${photoURL(f)}" onerror="this.src='${placeholderImg}'"></td>
      </tr>`;
  });
  rankList.style.display="none";
  comparisonView.style.display="block";
  backBtn.style.display="inline-block";
  compareBtn.style.display="none";
};
document.getElementById("backBtn").onclick=()=>{
  comparisonView.style.display="none";
  rankList.style.display="block";
  backBtn.style.display="none";
  compareBtn.style.display="inline-block";
};
document.getElementById("rankOwnBtn").onclick=()=>{
  localStorage.removeItem(STORAGE_KEY);
  window.location.href=location.origin + location.pathname;
};

/* Share view mode */
(function checkViewMode(){
  const params=new URLSearchParams(window.location.search);
  if(params.get("view")!=="1") return;
  const raw=params.get("rankings");
  if(!raw) return;
  const rankingsFromURL=decodeURIComponent(raw).split("|");
  document.querySelectorAll(".rank-item").forEach((item,index)=>{
    const input=item.querySelector("input");
    input.value=rankingsFromURL[index]||"";
    input.readOnly=true;
    item.draggable=false;
  });
  clearBtn.style.display="none";
  submitBtn.style.display="none";
  shareBtn.style.display="none";
  compareBtn.style.display="none";
  backBtn.style.display="none";
  document.getElementById("rankOwnBtn").style.display="inline-block";
})();

updatePhotos();
updateNumbers();
</script>
</body>
</html>
